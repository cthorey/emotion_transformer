---

title: Data 

keywords: fastai
sidebar: home_sidebar

summary: "data exploration and construction of the Dataloader for the SemEval-2019 Task 3 dataset (contextual emotion detection in text)"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_dataloader.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-exploration">Data exploration<a class="anchor-link" href="#Data-exploration">&#182;</a></h2><p>Let us first take a look at the preprocessed data using Pandas.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="open_data" class="doc_header"><code>open_data</code><a href="https://github.com/juliusberner/emotion_transformer/tree/master/emotion_transformer/dataloader.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>open_data</code>(<strong><code>path</code></strong>)</p>
</blockquote>
<p>returns a Pandas DataFrame consisting of the SemEval data at path <code>path</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;data/clean_train.txt&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">open_data</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>turn1</th>
      <th>turn2</th>
      <th>turn3</th>
      <th>label</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>do not worry i am girl</td>
      <td>hmm how do i know if you are</td>
      <td>what ' s ur name ?</td>
      <td>others</td>
    </tr>
    <tr>
      <th>1</th>
      <td>when did i ?</td>
      <td>saw many times i think shame</td>
      <td>no . i never saw you</td>
      <td>angry</td>
    </tr>
    <tr>
      <th>2</th>
      <td>by</td>
      <td>by google chrome</td>
      <td>where you live</td>
      <td>others</td>
    </tr>
    <tr>
      <th>3</th>
      <td>u r ridiculous</td>
      <td>i might be ridiculous but i am telling the tru...</td>
      <td>u little disgusting whore</td>
      <td>angry</td>
    </tr>
    <tr>
      <th>4</th>
      <td>just for time pass</td>
      <td>wt do u do 4 a living then</td>
      <td>maybe</td>
      <td>others</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(30160, 4)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As you can see we are dealing with very unformal language, typos, and bad grammar. Moreoever, we are given an unbalanced dataset:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>others    14948
angry      5506
sad        5463
happy      4243
Name: label, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Transforms">Data Transforms<a class="anchor-link" href="#Data-Transforms">&#182;</a></h2><p>We now tokenize the examples into features and create attention masks according to the (Distil)Bert standard. The following image from Jay Alammar's great blog post <a href="https://jalammar.github.io/a-visual-guide-to-using-bert-for-the-first-time/">A Visual Guide to Using BERT for the First Time</a> visualizes the tokenization step.</p>
<p><img src="./images/bert-distilbert-tokenization-2-token-ids.png" alt="Tokenization explained visually"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="transform_data" class="doc_header"><code>transform_data</code><a href="https://github.com/juliusberner/emotion_transformer/tree/master/emotion_transformer/dataloader.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>transform_data</code>(<strong><code>df</code></strong>, <strong><code>max_seq_len</code></strong>)</p>
</blockquote>
<p>returns the padded input ids and attention masks according to the DistilBert tokenizer</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">max_seq_len</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">padded</span><span class="p">,</span> <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">transform_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">max_seq_len</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">padded</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">attention_mask</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;turn1&#39;</span><span class="p">,</span><span class="s1">&#39;turn2&#39;</span><span class="p">,</span><span class="s1">&#39;turn3&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_seq_len</span><span class="p">,)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lets digest the outcome for the first two conversations.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>turn1</th>
      <th>turn2</th>
      <th>turn3</th>
      <th>label</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>do not worry i am girl</td>
      <td>hmm how do i know if you are</td>
      <td>what ' s ur name ?</td>
      <td>others</td>
    </tr>
    <tr>
      <th>1</th>
      <td>when did i ?</td>
      <td>saw many times i think shame</td>
      <td>no . i never saw you</td>
      <td>angry</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The utterances are transformed according to the tokenizer vocabulary</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vocab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DistilBertTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">&#39;distilbert-base-uncased&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="n">vocab</span><span class="p">[</span><span class="n">padded</span><span class="p">[:</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[[&#39;[CLS]&#39;, &#39;101&#39;, &#39;do&#39;, &#39;2079&#39;, &#39;not&#39;, &#39;2025&#39;, &#39;worry&#39;, &#39;4737&#39;,
         &#39;i&#39;, &#39;1045&#39;, &#39;am&#39;, &#39;2572&#39;, &#39;girl&#39;, &#39;2611&#39;, &#39;[SEP]&#39;, &#39;102&#39;,
         &#39;[PAD]&#39;, &#39;0&#39;, &#39;[PAD]&#39;, &#39;0&#39;],
        [&#39;[CLS]&#39;, &#39;101&#39;, &#39;hmm&#39;, &#39;17012&#39;, &#39;how&#39;, &#39;2129&#39;, &#39;do&#39;, &#39;2079&#39;,
         &#39;i&#39;, &#39;1045&#39;, &#39;know&#39;, &#39;2113&#39;, &#39;if&#39;, &#39;2065&#39;, &#39;you&#39;, &#39;2017&#39;,
         &#39;are&#39;, &#39;2024&#39;, &#39;[SEP]&#39;, &#39;102&#39;],
        [&#39;[CLS]&#39;, &#39;101&#39;, &#39;what&#39;, &#39;2054&#39;, &#34;&#39;&#34;, &#39;1005&#39;, &#39;s&#39;, &#39;1055&#39;, &#39;ur&#39;,
         &#39;24471&#39;, &#39;name&#39;, &#39;2171&#39;, &#39;?&#39;, &#39;1029&#39;, &#39;[SEP]&#39;, &#39;102&#39;, &#39;[PAD]&#39;,
         &#39;0&#39;, &#39;[PAD]&#39;, &#39;0&#39;]],

       [[&#39;[CLS]&#39;, &#39;101&#39;, &#39;when&#39;, &#39;2043&#39;, &#39;did&#39;, &#39;2106&#39;, &#39;i&#39;, &#39;1045&#39;,
         &#39;?&#39;, &#39;1029&#39;, &#39;[SEP]&#39;, &#39;102&#39;, &#39;[PAD]&#39;, &#39;0&#39;, &#39;[PAD]&#39;, &#39;0&#39;,
         &#39;[PAD]&#39;, &#39;0&#39;, &#39;[PAD]&#39;, &#39;0&#39;],
        [&#39;[CLS]&#39;, &#39;101&#39;, &#39;saw&#39;, &#39;2387&#39;, &#39;many&#39;, &#39;2116&#39;, &#39;times&#39;, &#39;2335&#39;,
         &#39;i&#39;, &#39;1045&#39;, &#39;think&#39;, &#39;2228&#39;, &#39;shame&#39;, &#39;9467&#39;, &#39;[SEP]&#39;, &#39;102&#39;,
         &#39;[PAD]&#39;, &#39;0&#39;, &#39;[PAD]&#39;, &#39;0&#39;],
        [&#39;[CLS]&#39;, &#39;101&#39;, &#39;no&#39;, &#39;2053&#39;, &#39;.&#39;, &#39;1012&#39;, &#39;i&#39;, &#39;1045&#39;,
         &#39;never&#39;, &#39;2196&#39;, &#39;saw&#39;, &#39;2387&#39;, &#39;you&#39;, &#39;2017&#39;, &#39;[SEP]&#39;, &#39;102&#39;,
         &#39;[PAD]&#39;, &#39;0&#39;, &#39;[PAD]&#39;, &#39;0&#39;]]], dtype=&#39;&lt;U18&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>...resulting in the corresponding input ids (padded with zeros to <code>max_seq_len</code>)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">padded</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[[  101,  2079,  2025,  4737,  1045,  2572,  2611,   102,     0,     0],
         [  101, 17012,  2129,  2079,  1045,  2113,  2065,  2017,  2024,   102],
         [  101,  2054,  1005,  1055, 24471,  2171,  1029,   102,     0,     0]],

        [[  101,  2043,  2106,  1045,  1029,   102,     0,     0,     0,     0],
         [  101,  2387,  2116,  2335,  1045,  2228,  9467,   102,     0,     0],
         [  101,  2053,  1012,  1045,  2196,  2387,  2017,   102,     0,     0]]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>...and masks for the self-attention layers specifying the length of each utterance:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">attention_mask</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[[1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
         [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
         [1, 1, 1, 1, 1, 1, 1, 1, 0, 0]],

        [[1, 1, 1, 1, 1, 1, 0, 0, 0, 0],
         [1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
         [1, 1, 1, 1, 1, 1, 1, 1, 0, 0]]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We also transform the labels to integers according to a given dictionary <code>emo_dict</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_labels" class="doc_header"><code>get_labels</code><a href="https://github.com/juliusberner/emotion_transformer/tree/master/emotion_transformer/dataloader.py#L37" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_labels</code>(<strong><code>df</code></strong>, <strong><code>emo_dict</code></strong>)</p>
</blockquote>
<p>returns the labels according to the emotion dictionary</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">emo_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;others&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sad&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;angry&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;happy&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">get_labels</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">emo_dict</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let us look at the result for our two conversations from above:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">labels</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([0, 2])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following widget allows to interactively explore the former data transformations.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="PyTorch-Dataloader">PyTorch Dataloader<a class="anchor-link" href="#PyTorch-Dataloader">&#182;</a></h2><p>Finally we aggregate all the functions above into a PyTorch dataloader (with optional <a href="https://pytorch.org/tutorials/beginner/aws_distributed_training_tutorial.html?highlight=distributedsampler">distributed training</a>).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dataloader" class="doc_header"><code>dataloader</code><a href="https://github.com/juliusberner/emotion_transformer/tree/master/emotion_transformer/dataloader.py#L44" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dataloader</code>(<strong><code>path</code></strong>, <strong><code>max_seq_len</code></strong>, <strong><code>batch_size</code></strong>, <strong><code>emo_dict</code></strong>, <strong><code>use_ddp</code></strong>=<em><code>False</code></em>, <strong><code>labels</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Transforms the .csv data stored in <code>path</code> according to DistilBert features and returns it as a DataLoader</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">dataloader</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">max_seq_len</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">emo_dict</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A batch consists of <code>batch_size</code> input ids, attention_masks, and optionally the corresponding labels.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">batch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">loader</span><span class="p">))</span>
<span class="n">batch</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[tensor([[[  101,  1045,  2053,  2021,  1045,  2123,  2102,  2053,  2055,   102],
          [  101,  2017,  2024,  2061, 10140,   102,     0,     0,     0,     0],
          [  101,  2053,  1045,  2572,  2200,  4854,  1998,  2200, 23701,   102]],
 
         [[  101,  2047,  3715,  2099,   102,     0,     0,     0,     0,     0],
          [  101,  6517,  2518,  2055,  2009,  2003,  2008,  2009,  2003,   102],
          [  101,  2021,  1037,  2047,  3042,  2097,  2022,  2488,   102,     0]],
 
         [[  101,  7929,  2026,  2190,  2767,  6737,   102,     0,     0,     0],
          [  101,  2061,  2115,  2063,  2025,  1996,  2190,  2767,  1997,   102],
          [  101,  2115,  2026,  2190,  2767,   102,     0,     0,     0,     0]],
 
         [[  101,  1045,  2215,  2009,   102,     0,     0,     0,     0,     0],
          [  101,  2168,   102,     0,     0,     0,     0,     0,     0,     0],
          [  101,  2021,  2017,  2024, 11878,  2033,   102,     0,     0,     0]],
 
         [[  101,  1998,  1029,   102,     0,     0,     0,     0,     0,     0],
          [  101,  2339,  2052,  2017,  2130,  4929,  2214,  4253,  4312,   102],
          [  101,  2138,  1997, 15792,   102,     0,     0,     0,     0,     0]]]),
 tensor([[[1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
          [1, 1, 1, 1, 1, 1, 0, 0, 0, 0],
          [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]],
 
         [[1, 1, 1, 1, 1, 0, 0, 0, 0, 0],
          [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
          [1, 1, 1, 1, 1, 1, 1, 1, 1, 0]],
 
         [[1, 1, 1, 1, 1, 1, 1, 0, 0, 0],
          [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
          [1, 1, 1, 1, 1, 1, 0, 0, 0, 0]],
 
         [[1, 1, 1, 1, 1, 0, 0, 0, 0, 0],
          [1, 1, 1, 0, 0, 0, 0, 0, 0, 0],
          [1, 1, 1, 1, 1, 1, 1, 0, 0, 0]],
 
         [[1, 1, 1, 1, 0, 0, 0, 0, 0, 0],
          [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
          [1, 1, 1, 1, 1, 0, 0, 0, 0, 0]]]),
 tensor([2, 0, 0, 1, 0])]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can find, for instance, the first conversation of this batch in our input ids above.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">conversation</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">conversation</span> <span class="o">==</span> <span class="n">padded</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="kc">True</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
 

